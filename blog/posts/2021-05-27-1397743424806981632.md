---
title: mysqlä¸­ä¸€åƒä¸ªä¸ç”¨NULLçš„ç†ç”±
subtitle: æŠ€æœ¯åˆ†äº«
author: systemime
date: 2021-05-27
header_img: /img/in-post/header/6.jpg
catalog: True
tags:
  - sql
---

MySQLä¸­nullå¯¹æ€§èƒ½æœ‰éå¸¸å¤§å¯¹å½±å“ï¼ŒèŠèŠä½¿ç”¨nullçš„åŸå› ä»¥åŠä¸ç”¨nullçš„ç†ç”±

<!-- more -->

æ¸¯çœŸï¼ŒNull è²Œä¼¼åœ¨å“ªé‡Œéƒ½æ˜¯ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼Œæ¯”å¦‚ Java é‡Œè®©äººå¤´ç–¼çš„ NullPointerExceptionï¼Œä¸ºäº†é¿å…çŒä¸åŠé˜²çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œåƒç™¾å¹´æ¥ç¨‹åºçŒ¿ä»¬ä¸å¾—ä¸åœ¨ä»£ç é‡Œå°å¿ƒç¿¼ç¿¼çš„å„ç§ if åˆ¤æ–­ï¼Œéº»çƒ¦è€Œåˆè‡ƒè‚¿ï¼Œä¸ºæ­¤ java8 å¼•å…¥äº† Optional æ¥é¿å…è¿™ä¸€é—®é¢˜ã€‚

ä¸‹é¢å’±ä»¬è¦èŠçš„æ˜¯ MySQL é‡Œçš„ nullï¼Œåœ¨å¤§é‡çš„ MySQL ä¼˜åŒ–æ–‡ç« å’Œä¹¦ç±é‡Œéƒ½æåˆ°äº†å­—æ®µå°½å¯èƒ½ç”¨NOT NULLï¼Œè€Œä¸æ˜¯NULLï¼Œé™¤éç‰¹æ®Šæƒ…å†µã€‚
ä½†å´éƒ½åªç»™ç»“è®ºä¸è¯´æ˜åŸå› ï¼ŒçŠ¹å¦‚é¸¡æ±¤ä¸ç»™å‹ºå­ä¸€æ ·ï¼Œè®©ä¸å°‘åˆå­¦è€…å¯¹è¿™ä¸ªç»“è®ºåŠä¿¡åŠç–‘æˆ–è€…äº‘é‡Œé›¾é‡Œã€‚æœ¬æ–‡ä»Šå¤©å°±è¯¦ç»†çš„å‰–æä¸‹ä½¿ç”¨ Null çš„åŸå› ï¼Œå¹¶ç»™å‡ºä¸€äº›ä¸ç”¨ Null çš„ç†ç”±ã€‚

## 1. NULL ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäººç”¨ï¼Ÿ
NULLæ˜¯åˆ›å»ºæ•°æ®è¡¨æ—¶é»˜è®¤çš„ï¼Œåˆçº§æˆ–ä¸çŸ¥æƒ…çš„æˆ–æ€•éº»çƒ¦çš„ç¨‹åºå‘˜ä¸ä¼šæ³¨æ„è¿™ç‚¹ã€‚

å¾ˆå¤šäººå‘˜éƒ½ä»¥ä¸º`not null` éœ€è¦æ›´å¤šç©ºé—´ï¼Œå…¶å®è¿™ä¸æ˜¯é‡ç‚¹ã€‚
é‡ç‚¹æ˜¯å¾ˆå¤šç¨‹åºå‘˜è§‰å¾—NULLåœ¨å¼€å‘ä¸­ä¸ç”¨å»åˆ¤æ–­æ’å…¥æ•°æ®ï¼Œå†™sqlè¯­å¥çš„æ—¶å€™æ›´æ–¹ä¾¿å¿«æ·ã€‚

## 2. æ˜¯ä¸æ˜¯ä»¥è®¹ä¼ è®¹ï¼Ÿ

MySQL å®˜ç½‘æ–‡æ¡£ï¼š

> NULL columns require additional space in the rowto record whether their values are NULL. For MyISAM tables, each NULL columntakes one bit extra, rounded up to the nearest byte.
> Mysqléš¾ä»¥ä¼˜åŒ–å¼•ç”¨å¯ç©ºåˆ—æŸ¥è¯¢ï¼Œå®ƒä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ã€‚å¯ç©ºåˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜éœ€è¦mysqlå†…éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¯ç©ºåˆ—è¢«ç´¢å¼•åï¼Œæ¯æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œè¿˜èƒ½å¯¼è‡´MYisam ä¸­å›ºå®šå¤§å°çš„ç´¢å¼•å˜æˆå¯å˜å¤§å°çš„ç´¢å¼•ã€‚
>   â€”â€” å‡ºè‡ªã€Šé«˜æ€§èƒ½mysqlç¬¬äºŒç‰ˆã€‹

ç…§æ­¤åˆ†æï¼Œè¿˜çœŸä¸æ˜¯ä»¥è®¹ä¼ è®¹ï¼Œè¿™æ˜¯æœ‰ç†è®ºä¾æ®å’Œå‡ºå¤„çš„ã€‚

## 3. ç»™æˆ‘ä¸€ä¸ªä¸ç”¨ Null çš„ç†ç”±ï¼Ÿ

1. æ‰€æœ‰ä½¿ç”¨NULLå€¼çš„æƒ…å†µï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæœ‰æ„ä¹‰çš„å€¼çš„è¡¨ç¤ºï¼Œè¿™æ ·æœ‰åˆ©äºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¹¶èƒ½ä»çº¦æŸä¸Šå¢å¼ºä¸šåŠ¡æ•°æ®çš„è§„èŒƒæ€§ã€‚
2. NULLå€¼åˆ°éNULLçš„æ›´æ–°æ— æ³•åšåˆ°åŸåœ°æ›´æ–°ï¼Œæ›´å®¹æ˜“å‘ç”Ÿç´¢å¼•åˆ†è£‚ï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚
   
   ==æ³¨æ„ï¼šä½†æŠŠ **NULL** åˆ—æ”¹ä¸º **NOT NULL** å¸¦æ¥çš„æ€§èƒ½æç¤ºå¾ˆå°ï¼Œé™¤éç¡®å®šå®ƒå¸¦æ¥äº†é—®é¢˜ï¼Œå¦åˆ™ä¸è¦æŠŠå®ƒå½“æˆä¼˜å…ˆçš„ä¼˜åŒ–æªæ–½ï¼Œæœ€é‡è¦çš„æ˜¯ä½¿ç”¨çš„åˆ—çš„ç±»å‹çš„é€‚å½“æ€§ã€‚==

3. NULLå€¼åœ¨timestampç±»å‹ä¸‹å®¹æ˜“å‡ºé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯æ²¡æœ‰å¯ç”¨å‚æ•° `explicit_defaults_for_timestamp`
4. `NOT IN`ã€`!=` ç­‰è´Ÿå‘æ¡ä»¶æŸ¥è¯¢åœ¨æœ‰ `NULL` å€¼çš„æƒ…å†µä¸‹è¿”å›æ°¸è¿œä¸ºç©ºç»“æœï¼ŒæŸ¥è¯¢å®¹æ˜“å‡ºé”™ 
   
    > ä¸¾ä¸ªæ —å­ ğŸŒ°
  
    ```sql
    create table table_2 (
       `id` INT (11) NOT NULL,
      user_name varchar(20) NOT NULL
    )
    
    
    create table table_3 (
       `id` INT (11) NOT NULL,
      user_name varchar(20)
    )
    
    insert into table_2 values (4,"zhaoliu_2_1"),(2,"lisi_2_1"),(3,"wangmazi_2_1"),(1,"zhangsan_2"),(2,"lisi_2_2"),(4,"zhaoliu_2_2"),(3,"wangmazi_2_2")
    
    insert into table_3 values (1,"zhaoliu_2_1"),(2, null)
    ```
    
    - eg.1 `NOT IN` å­æŸ¥è¯¢åœ¨æœ‰NULLå€¼çš„æƒ…å†µä¸‹è¿”å›æ°¸è¿œä¸ºç©ºç»“æœï¼ŒæŸ¥è¯¢å®¹æ˜“å‡ºé”™
    
    ```sql
    -- 
    select user_name from table_2 where user_name not in (select user_name from table_3 where id!=1)
    
    mysql root@10.48.186.32:t_test_zz5431> select user_name from table_2 where user_name not
                                        -> in (select user_name from table_3 where id!=1);
    +-------------+
    | user_name   |
    |-------------|
    +-------------+
    0 rows in set
    Time: 0.008s
    mysql root@10.48.186.32:t_test_zz5431>
    ```
    
    - eg.2 å•åˆ—ç´¢å¼•ä¸å­˜nullå€¼ï¼Œå¤åˆç´¢å¼•ä¸å­˜å…¨ä¸ºnullçš„å€¼ï¼Œå¦‚æœåˆ—å…è®¸ä¸ºnullï¼Œå¯èƒ½ä¼šå¾—åˆ°â€œä¸ç¬¦åˆé¢„æœŸâ€çš„ç»“æœé›†
    
    ```sql
    -- å¦‚æœnameå…è®¸ä¸ºnullï¼Œç´¢å¼•ä¸å­˜å‚¨nullå€¼ï¼Œç»“æœé›†ä¸­ä¸ä¼šåŒ…å«è¿™äº›è®°å½•ã€‚æ‰€ä»¥ï¼Œè¯·ä½¿ç”¨not nullçº¦æŸä»¥åŠé»˜è®¤å€¼ã€‚
    select * from table_3 where name != 'zhaoliu_2_1'
    ```
    
    - eg.3 å¦‚æœåœ¨ä¸¤ä¸ªå­—æ®µè¿›è¡Œæ‹¼æ¥ï¼šæ¯”å¦‚é¢˜å·+åˆ†æ•°ï¼Œé¦–å…ˆè¦å„å­—æ®µè¿›è¡Œénullåˆ¤æ–­ï¼Œå¦åˆ™åªè¦ä»»æ„ä¸€ä¸ªå­—æ®µä¸ºç©ºéƒ½ä¼šé€ æˆæ‹¼æ¥çš„ç»“æœä¸ºnull
    
    ```sql
    select CONCAT("1",null) from dual; -- æ‰§è¡Œç»“æœä¸ºnullã€‚
    ```
    
    - eg.4 å¦‚æœæœ‰ Null column å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œcount(Null column)éœ€è¦æ ¼å¤–æ³¨æ„ï¼Œnull å€¼ä¸ä¼šå‚ä¸ç»Ÿè®¡
    
    ```sql
    mysql root@10.48.186.32:t_test_zz5431> select * from table_3;
    +------+-------------+
    |   id | user_name   |
    |------+-------------|
    |    1 | zhaoliu_2_1 |
    |    2 | <null>      |
    |   21 | zhaoliu_2_1 |
    |   22 | <null>      |
    +------+-------------+
    4 rows in set
    Time: 0.007s
    mysql root@10.48.186.32:t_test_zz5431> select count(user_name) from table_3;
    +--------------------+
    |   count(user_name) |
    |--------------------|
    |                  2 |
    +--------------------+
    1 row in set
    Time: 0.007s
    ```
    
    - eg.5 æ³¨æ„ Null å­—æ®µçš„åˆ¤æ–­æ–¹å¼ï¼Œ = null å°†ä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœ
    
    ```sql
    mysql root@localhost:cygwin> create index IDX_test on table_3 (user_name);
    Query OK, 0 rows affected
    Time: 0.040s
    mysql root@localhost:cygwin>  select * from table_3 where user_name is null\G
    ***************************[ 1. row ]***************************
    id        | 2
    user_name | None
    
    1 row in set
    Time: 0.002s
    mysql root@localhost:cygwin> select * from table_3 where user_name = null\G
    
    0 rows in set
    Time: 0.002s
    mysql root@localhost:cygwin> desc select * from table_3 where user_name = 'zhaoliu_2_1'\G
    ***************************[ 1. row ]***************************
    id            | 1
    select_type   | SIMPLE
    table         | table_3
    type          | ref
    possible_keys | IDX_test
    key           | IDX_test
    key_len       | 23
    ref           | const
    rows          | 1
    Extra         | Using where
    
    1 row in set
    Time: 0.006s
    mysql root@localhost:cygwin> desc select * from table_3 where user_name = null\G
    ***************************[ 1. row ]***************************
    id            | 1
    select_type   | SIMPLE
    table         | None
    type          | None
    possible_keys | None
    key           | None
    key_len       | None
    ref           | None
    rows          | None
    Extra         | Impossible WHERE noticed after reading const tables
    
    1 row in set
    Time: 0.002s
    mysql root@localhost:cygwin> desc select * from table_3 where user_name is null\G
    ***************************[ 1. row ]***************************
    id            | 1
    select_type   | SIMPLE
    table         | table_3
    type          | ref
    possible_keys | IDX_test
    key           | IDX_test
    key_len       | 23
    ref           | const
    rows          | 1
    Extra         | Using where
    
    1 row in set
    Time: 0.002s
    mysql root@localhost:cygwin>
    ```

5. Null åˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼šéœ€è¦ä¸€ä¸ªé¢å¤–å­—èŠ‚ä½œä¸ºåˆ¤æ–­æ˜¯å¦ä¸º NULL çš„æ ‡å¿—ä½

    å†ä¸¾ä¸ªæ —å­ğŸŒ°

    ![å˜¿å‘€](/img/in-post/2021-05-27-1397743424806981632/img.png)
   
    ```sql
    alter table table_3 add index idx_user_name (user_name);
    alter table table_2 add index idx_user_name (user_name);
    explain select * from table_2 where user_name='zhaoliu_2_1';
    explain select * from table_3 where user_name='zhaoliu_2_1';
    ```

    ![sqlç»“æœ](/img/in-post/2021-05-27-1397743424806981632/img_1.png)

    å¯ä»¥çœ‹åˆ°åŒæ ·çš„ varchar(20) é•¿åº¦ï¼Œtable_2 è¦æ¯” table_3 ç´¢å¼•é•¿åº¦å¤§ï¼Œè¿™æ˜¯å› ä¸ºï¼š

    ä¸¤å¼ è¡¨çš„å­—ç¬¦é›†ä¸ä¸€æ ·ï¼Œä¸”å­—æ®µä¸€ä¸ªä¸º NULL ä¸€ä¸ªé NULL

    ![sqlç»“æœ_2](/img/in-post/2021-05-27-1397743424806981632/img_1.png)


## æ€»ç»“

**key_len çš„è®¡ç®—è§„åˆ™å’Œä¸‰ä¸ªå› ç´ æœ‰å…³ï¼šæ•°æ®ç±»å‹ã€å­—ç¬¦ç¼–ç ã€æ˜¯å¦ä¸º NULL**

```
key_len 62 == 20*3ï¼ˆutf8 3å­—èŠ‚ï¼‰ + 2 ï¼ˆå­˜å‚¨ varchar å˜é•¿å­—ç¬¦é•¿åº¦ 2å­—èŠ‚ï¼Œå®šé•¿å­—æ®µæ— éœ€é¢å¤–çš„å­—èŠ‚ï¼‰
    
key_len 83 == 20*4ï¼ˆutf8mb4 4å­—èŠ‚ï¼‰ + 1 (æ˜¯å¦ä¸º Null çš„æ ‡è¯†) + 2 ï¼ˆå­˜å‚¨ varchar å˜é•¿å­—ç¬¦é•¿åº¦ 2å­—èŠ‚ï¼Œå®šé•¿å­—æ®µæ— éœ€é¢å¤–çš„å­—èŠ‚ï¼‰
```

æ‰€ä»¥è¯´ç´¢å¼•å­—æ®µæœ€å¥½ä¸è¦ä¸ºNULLï¼Œå› ä¸ºNULLä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ï¼Œå¹¶ä¸”éœ€è¦é¢å¤–ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚åŸºäºä»¥ä¸Šè¿™äº›ç†ç”±å’ŒåŸå› ï¼Œæˆ‘æƒ³å’±ä»¬ä¸ç”¨ Null çš„ç†ç”±åº”è¯¥æ˜¯å¤Ÿäº† ğŸ™‚


[https://www.techug.com/post/you-should-not-use-null-in-mysql.html](https://www.techug.com/post/you-should-not-use-null-in-mysql.html)
